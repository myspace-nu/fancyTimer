/*!
 * fancyTimer v1.0.1
 * https://github.com/myspace-nu
 *
 * Copyright 2021 Johan Johansson
 * Released under the MIT license
 */

class fancytimer{constructor(t){return this.settings=function n(...t){const a=t=>t&&"object"==typeof t;return t.reduce((e,h)=>(Object.keys(h).forEach(t=>{const s=e[t],i=h[t];Array.isArray(s)&&Array.isArray(i)?e[t]=s.concat(...i):a(s)&&a(i)?e[t]=n(s,i):e[t]=i}),e),{})}({hours:0,minutes:0,seconds:0,showGrains:!0,loop:!1,style:{color:"#aaa",font:"Arial","line-width":8},formatter:function(t){return{text:Math.ceil(t.remainingms/1e3),percentDone:t.remainingms/t.totalTime*100}},onElapsed:function(){},onPause:function(){},onResume:function(){},onStop:function(){},onStart:function(){},onReset:function(){}},t),this.settings.seconds=3600*this.settings.hours+60*this.settings.minutes+this.settings.seconds,this.canvasElm=document.getElementById(this.settings.canvas),this.ctx=this.canvasElm.getContext("2d",{willReadFrequently:!0}),this.reset(),this.updateTimer(),this}stopTimer(){window.clearInterval(this.timer)}reset(){this.settings.loop||this.stopTimer(),this.paused=!1,this.started=!1,this.startTime=this.settings.startTime??new Date,this.endTime=this.settings.endTime??null,this.endTime&&this.settings.seconds&&(this.startTime=new Date(this.endTime.getTime()-1e3*this.settings.seconds)),this.endTime&&!this.settings.seconds&&(this.startTime=new Date),this.endTime=this.endTime??this.settings.seconds?new Date(this.startTime.getTime()+1e3*this.settings.seconds):new Date,this.settings.loop&&(this.startTime=new Date,this.endTime=new Date(this.startTime.getTime()+1e3*this.settings.seconds),this.started=!0),this.elapsedms=0,this.remainingms=this.settings.seconds?1e3*this.settings.seconds:this.endTime.getTime()-this.startTime.getTime(),this.totalTime=this.remainingms,this.settings.onReset.call(this)}formatTime(t){t=Math.round(t);var s=Math.floor(t/3600),i=Math.floor((t-3600*s)/60),e=t-3600*s-60*(i=3600<=t&&i<10?"0"+i:i),e=60<=t&&e<10?"0"+e:e;return 3600<=t?s+":"+i+":"+e:60<t?i+":"+e:t}circle(t,s,i,e,h){t.beginPath(),t.lineWidth=0,h&&(t.fillStyle=h),t.arc(s,i,e,0,2*Math.PI),t.fill()}displace(t,s,i,e){return{x:t+e*Math.cos((i-90)*(Math.PI/180)),y:s+e*Math.sin((i-90)*(Math.PI/180))}}updateTimer(){if(!this.paused){this.startTime&&(new Date).getTime()>this.startTime.getTime()&&(this.elapsedms=(new Date).getTime()-this.startTime.getTime(),this.remainingms=this.endTime.getTime()-(new Date).getTime()),this.remainingms<=0&&(this.settings.loop?this.reset():(this.stopTimer(),this.elapsedms=1e3*this.settings.seconds,this.remainingms=0),this.settings.onElapsed.call(this,this));var t=this.settings.formatter(this),s="object"==typeof t&&"percentDone"in t?t.percentDone/100:this.remainingms/(this.endTime.getTime()-this.startTime.getTime()),i="object"==typeof t&&"text"in t?t.text:t;this.ctx.clearRect(0,0,this.canvasElm.width,this.canvasElm.height),this.ctx.beginPath(),this.ctx.strokeStyle=this.settings.style.color,this.ctx.lineWidth=this.canvasElm.width*(this.settings.style["line-width"]/200),this.ctx.arc(this.canvasElm.width/2,this.canvasElm.height/2,Math.min(this.canvasElm.width,this.canvasElm.height)/2-this.ctx.lineWidth/2,Math.PI/180*-90,(360*s-90)*(Math.PI/180)),this.ctx.stroke();var e=this.displace(this.canvasElm.width/2,this.canvasElm.height/2,0,Math.min(this.canvasElm.width,this.canvasElm.height)/2-this.ctx.lineWidth/2);if(this.circle(this.ctx,e.x,e.y,this.ctx.lineWidth/2,this.settings.style.color),e=this.displace(this.canvasElm.width/2,this.canvasElm.height/2,360*s,Math.min(this.canvasElm.width,this.canvasElm.height)/2-this.ctx.lineWidth/2),this.circle(this.ctx,e.x,e.y,this.ctx.lineWidth/2,this.settings.style.color),this.settings.showGrains)for(var h=1;s<h;h-=1/(300/this.settings.style["line-width"])){e=this.displace(this.canvasElm.width/2,this.canvasElm.height/2,360*h,Math.min(this.canvasElm.width,this.canvasElm.height)/2-this.ctx.lineWidth/2);this.circle(this.ctx,e.x,e.y,this.ctx.lineWidth/4,this.settings.style.color)}t=1/((""+i).length/6)*.4,t=Math.min(t,1),t=.5*Math.min(this.canvasElm.width,this.canvasElm.height)*t;this.ctx.font=t+"px "+this.settings.style.font,this.ctx.fillStyle=this.settings.style.color,this.ctx.textAlign="center",this.ctx.fillText(i,this.canvasElm.width/2,this.canvasElm.height/2+.75*t/2)}}start(){return this.reset(),this.startTime=this.settings.startTime??new Date,this.settings.seconds&&(this.endTime=new Date(this.startTime.getTime()+1e3*this.settings.seconds)),this.started=!0,this.timer=window.setInterval(function(t){t.updateTimer()},100,this),this.settings.onStart.call(this,this),this}pause(){if(this.started&&!this.paused)return this.pauseTime=new Date,this.paused=!0,this.settings.onPause.call(this,this),this}resume(){if(this.started&&this.paused){var t=(new Date).getTime()-this.pauseTime.getTime();return this.endTime=new Date(this.endTime.getTime()+t),this.paused=!1,this.settings.onResume.call(this,this),this}}stop(){return this.settings.loop=!1,this.reset(),this.updateTimer(),this.settings.onStop.call(this,this),this}}